<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grid Template</title>
    <!-- <link rel="stylesheet" href = "static/css/style_editor.css"> -->
    <!-- <link rel="stylesheet" href="{{url_for('static',filename='css/style_editor.css')}}"> -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='css/sytle_editor.css') }}">

</head>

<body>
    <header>
        <button class="button-1">Sign Out</button>
        <h1 style="text-align: center;">"Project Title"</h1>
        <button class="button-1" id="createVideo" onclick="uploadImages()">Video Preview</button>
    </header>
    <main>
        <div class="headings">
            <h2 id="imagesHeading" style="text-align: center;">Images</h2>
            <h2 id="transHeading" style="text-align: center;">Transitions</h2>
            <h2 id="audioHeading" style="text-align: center;">Audio</h2>
        </div>
        <div class="sections">
            <div class="section image-section" id="imageSection">
                <!-- <h2>Images</h2> -->
                <!-- Images Go Here -->
                {% for image in images %}
                <img src="data:image/jpeg;base64,{{ image }}" class="img" width="172px" height="115px" alt="Image">
                {% endfor %}


                <button id="transferBtn" style="width: 100%; background-color: #36454F; color: white;">Use
                    Images</button>
            </div>

            <div class="section transition-section">
                <!-- <h2>Transitions</h2> -->
                <div class="transition-section" id="transitionSection">
                    <!-- <h2>Images</h2> -->
                    <!-- Images Go Here -->
                    <img src="static/img/slide_down.png" width="122px" height="70px" class="transition-image"
                        style="padding-top: 8px;">
                    <img src="static/img/slide_left.png" width="122px" height="70px" class="transition-image"
                        style="padding-top: 8px;">
                    <img src="static/img/slide_right.png" width="122px" height="70px" class="transition-image"
                        style="padding-top: 8px;">
                    <img src="static/img/slide_up.png" width="122px" height="70px" class="transition-image"
                        style="padding-top: 8px;">
                    <img src="static/img/slide_down.png" width="122px" height="70px" class="transition-image"
                        style="padding-top: 8px;">
                    <img src="static/img/slide_left.png" width="122px" height="70px" class="transition-image"
                        style="padding-top: 8px;">
                    <img src="static/img/slide_down.png" width="122px" height="70px" class="transition-image"
                        style="padding-top: 8px;">
                    <img src="static/img/slide_left.png" width="122px" height="70px" class="transition-image"
                        style="padding-top: 8px;">
                    <img src="static/img/slide_right.png" width="122px" height="70px" class="transition-image"
                        style="padding-top: 8px;">
                    <img src="static/img/slide_up.png" width="122px" height="70px" class="transition-image"
                        style="padding-top: 8px;">
                    <img src="static/img/slide_down.png" width="122px" height="70px" class="transition-image"
                        style="padding-top: 8px;">
                    <img src="static/img/slide_left.png" width="122px" height="70px" class="transition-image"
                        style="padding-top: 8px;">
                </div>
                <!-- Transitions Go Here -->
            </div>
            <div class="section audio-section">
                <div class="audio-file">
                    <audio controls>
                        <source src="dummy_audio1.mp3" type="audio/mp3">
                        Your browser does not support the audio element.
                    </audio>
                    <label for="duration1">Start: </label>
                    <input type="text" id="duration1" name="duration1" placeholder="0 Sec" size="9">
                    <label for="duration1">End: </label>
                    <input type="text" id="duration1" name="duration1" placeholder="0 Sec" size="9">

                </div>

                <div class="audio-file">
                    <audio controls>
                        <source src="dummy_audio2.mp3" type="audio/mp3">
                        Your browser does not support the audio element.
                    </audio>
                    <label for="duration1">Start: </label>
                    <input type="text" id="duration1" name="duration1" placeholder="0 Sec" size="9">
                    <label for="duration1">End: </label>
                    <input type="text" id="duration1" name="duration1" placeholder="0 Sec" size="9">
                </div>

                <div class="audio-file">
                    <audio controls>
                        <source src="dummy_audio2.mp3" type="audio/mp3">
                        Your browser does not support the audio element.
                    </audio>
                    <label for="duration1">Start: </label>
                    <input type="text" id="duration1" name="duration1" placeholder="0 Sec" size="9">
                    <label for="duration1">End: </label>
                    <input type="text" id="duration1" name="duration1" placeholder="0 Sec" size="9">
                </div>

                <div class="audio-file">
                    <audio controls>
                        <source src="dummy_audio2.mp3" type="audio/mp3">
                        Your browser does not support the audio element.
                    </audio>
                    <label for="duration1">Start: </label>
                    <input type="text" id="duration1" name="duration1" placeholder="0 Sec" size="9">
                    <label for="duration1">End: </label>
                    <input type="text" id="duration1" name="duration1" placeholder="0 Sec" size="9">
                </div>

                <div class="audio-file">
                    <audio controls>
                        <source src="dummy_audio2.mp3" type="audio/mp3">
                        Your browser does not support the audio element.
                    </audio>
                    <label for="duration1">Start: </label>
                    <input type="text" id="duration1" name="duration1" placeholder="0 Sec" size="9">
                    <label for="duration1">End: </label>
                    <input type="text" id="duration1" name="duration1" placeholder="0 Sec" size="9">
                </div>

                <div class="audio-file">
                    <audio controls>
                        <source src="dummy_audio2.mp3" type="audio/mp3">
                        Your browser does not support the audio element.
                    </audio>
                    <label for="duration1">Start: </label>
                    <input type="text" id="duration1" name="duration1" placeholder="0 Sec" size="9">
                    <label for="duration1">End: </label>
                    <input type="text" id="duration1" name="duration1" placeholder="0 Sec" size="9">
                </div>

                <div class="audio-file">
                    <audio controls>
                        <source src="dummy_audio2.mp3" type="audio/mp3">
                        Your browser does not support the audio element.
                    </audio>
                    <label for="duration1">Start: </label>
                    <input type="text" id="duration1" name="duration1" placeholder="0 Sec" size="9">
                    <label for="duration1">End: </label>
                    <input type="text" id="duration1" name="duration1" placeholder="0 Sec" size="9">
                </div>

                <div class="audio-file">
                    <audio controls>
                        <source src="dummy_audio2.mp3" type="audio/mp3">
                        Your browser does not support the audio element.
                    </audio>
                    <label for="duration1">Start: </label>
                    <input type="text" id="duration1" name="duration1" placeholder="0 Sec" size="9">
                    <label for="duration1">End: </label>
                    <input type="text" id="duration1" name="duration1" placeholder="0 Sec" size="9">
                </div>

                <div class="audio-file">
                    <audio controls>
                        <source src="dummy_audio2.mp3" type="audio/mp3">
                        Your browser does not support the audio element.
                    </audio>
                    <label for="duration1">Start: </label>
                    <input type="text" id="duration1" name="duration1" placeholder="0 Sec" size="9">
                    <label for="duration1">End: </label>
                    <input type="text" id="duration1" name="duration1" placeholder="0 Sec" size="9">
                </div>


                <!-- <h2>Audio</h2> -->
                <!-- Audio Files Go Here -->
            </div>
        </div>
        <div class="timeline" id="timeline">
            <!-- Timeline Images Go Here -->
        </div>
    </main>

    <script>
        // Function to toggle image selection
        function toggleSelection(event) {
            const image = event.target;
            const isSelected = image.classList.contains("selected");

            // Deselect all other transition images
            const transitionImages = document.querySelectorAll('.transition-image');
            transitionImages.forEach(img => img.classList.remove("selected"));

            // Toggle selection for the clicked image
            image.classList.toggle("selected", !isSelected);
        }

        // Function to transfer selected images to the timeline
        function transferToTimeline() {
            const selectedImages = document.querySelectorAll('.image-section .selected');
            const timeline = document.getElementById('timeline');

            // Check if adding selected images would exceed the limit
            const currentImagesCount = timeline.querySelectorAll('img').length;
            const imagesToAddCount = selectedImages.length;
            const totalImagesCount = currentImagesCount + imagesToAddCount;

            if (totalImagesCount > 30) {
                alert("You can't add more than 30 images to the timeline.");
                return;
            }

            selectedImages.forEach(image => {
                // Clone the selected image and remove the border
                const clone = image.cloneNode(true);
                clone.classList.remove("selected"); // Remove 'selected' class
                // clone.classList.append("timelineImage");
                clone.classList.toggle("timelineImage");
                clone.style.border = "none"; // Remove border
                timeline.appendChild(clone);
            });

            // Clear selection after transfer
            selectedImages.forEach(image => {
                image.classList.remove("selected");
            });
        }

        // Attach click event listener to images using event delegation
        document.getElementById('imageSection').addEventListener('click', function (event) {
            if (event.target.tagName === 'IMG') {
                toggleSelection(event);
            }
        });

        // Attach click event listener to transfer button
        document.getElementById('transferBtn').addEventListener('click', transferToTimeline);

        // Attach click event listener to transition images
        document.getElementById('transitionSection').addEventListener('click', function (event) {
            if (event.target.classList.contains('transition-image')) {
                toggleSelection(event);
            }
        });

        document.getElementById('createVideo').addEventListener('click', function () {
            // Make a GET request to trigger image extraction
            fetch('/extract_images')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to trigger image extraction');
                    }
                    return response.text();
                })
                .then(data => {
                    console.log(data); // Log the response message
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        });


        function uploadImages() {
            const images = document.querySelectorAll('.timelineImage');
            const formData = new FormData();

            images.forEach(img => {
                formData.append('files[]', dataURItoBlob(img.src), 'image.png');
            });

            fetch('/edit', {
                method: 'POST',
                body: formData
            })
                .then(response => {
                    if (response.ok) {
                        return response.text();
                    }
                    throw new Error('Network response was not ok.');
                })
                .then(data => {
                    console.log(data);
                })
                .catch(error => {
                    console.error('There was a problem with your fetch operation:', error);
                });
        }

        // Convert data URI to Blob
        function dataURItoBlob(dataURI) {
            const byteString = atob(dataURI.split(',')[1]);
            const mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
            const ab = new ArrayBuffer(byteString.length);
            const ia = new Uint8Array(ab);

            for (let i = 0; i < byteString.length; i++) {
                ia[i] = byteString.charCodeAt(i);
            }

            return new Blob([ab], { type: mimeString });
        }
    </script>
</body>

</html>